## AMQP (Advanced Message Queuing Protocol)

AMQP √© um protocolo que define as regras para envio, roteamento e recebimento de mensagens em sistemas de mensageria, como o RabbitMQ.

<img src="https://www.cloudamqp.com/img/docs/camqp.png" alt="">

<hr>
<br>

### Conceitos de RabbitMQ

Conceitos importantes precisam estar claros:

- **Producer**: Aplicativo que envia as mensagens.

<br>

- **Consumer**: Aplica√ß√£o que recebe as mensagens.

<br>

- **Exchanges**: Decide para qual fila a mensagem deve ser enviada.

<br>

- **Routing Key** (Chave de Roteamento): Pense nisso como o "endere√ßo" que o Producer coloca na mensagem. Quando o Produtor envia a mensagem para a Exchange, ele inclui essa Routing Key para indicar o destino desejado.

<br>

- **Queues**(filas): Onde as mensagens ficam armazenadas at√© serem consumidas.

<br>

- **Binding** (V√≠nculo): √â a conex√£o ou "regra" que liga uma Exchange a uma Fila.

<br>


- **Binding Key (Chave de V√≠nculo)**: A Exchange usa essa Binding Key para comparar com a Routing Key da mensagem e, assim, decidir se a mensagem deve ser enviada para aquela fila.

<br>

- **Mensagem**: Informa√ß√£o enviada do produtor para o consumidor atrav√©s do RabbitMQ.

<hr>
<br>

### Exchange (O Distribuidor de Mensagens)

Pense na Exchange como o distribuidor central de mensagens do RabbitMQ. Quando sua aplica√ß√£o (o produtor) envia uma mensagem, ela nunca vai direto para uma fila. Primeiro, ela chega na Exchange.

A principal fun√ß√£o da Exchange √© decidir para qual fila (ou filas) essa mensagem deve ser entregue. Ela faz essa "decis√£o" com base em regras de roteamento que configuramos, que s√£o os bindings e as routing keys.

<br>

#### Tipos de Exchange

O jeito que a Exchange decide para onde mandar a mensagem depende do seu **tipo**. 


- **Direct**: Roteia mensagens para filas cuja Binding Key corresponde exatamente √† Routing Key da mensagem.


    <img src="../img/rabbitmq_exchange_direct_1.png">

    <br>

    <img src="../img/rabbitmq_exchange_direct_2.png">

    <br>
    <br>
    
    üìñ A Exchange recebe a mensagem, analisa o Routing Key (o "endere√ßo" dela) e verifica se ela possui algum Binding Key com esse mesmo "endere√ßo". Se sim, ela envia a mensagem para aquela fila.

    <br>

    Imagine que:

    Voc√™ (o producer) envia uma carta e escreve um "endere√ßo" nela. Esse "endere√ßo" √© a Routing Key.
    A Exchange (o carteiro) tem v√°rias caixas de correio (as filas). Cada caixa tem um "endere√ßo que ela aceita", que √© a Binding Key.

    O que acontece? O carteiro (Exchange) pega sua carta. Se o "endere√ßo da carta" (Routing Key) for igualzinho a um dos "endere√ßos que ele aceita" (Binding Key), ele entrega a carta naquela caixa de correio (fila).

<br>
<br>

- **Fanout**: Tem um comportamento de "manda para todos". Ele simplesmente pega a mensagem e a replica para todas as filas, ignorando a routing key.

    <img src="../img/rabbitmq_exchange_fanout.png">


<ht>
<br>

### ACK

ACK √© um sinal que o consumidor envia de volta para o RabbitMQ, dizendo: "Ok, recebi e processei essa mensagem! Pode apagar da fila."

Se o consumidor n√£o envia o ACK (porque falhou ou n√£o terminou), a mensagem fica l√° para ser entregue de novo.

‚ö†Ô∏è melhorar resumo depois...